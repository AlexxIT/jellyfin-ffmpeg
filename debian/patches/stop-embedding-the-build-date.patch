From 103e4c58633f210d7c3203cae121ba5b5123afa6 Mon Sep 17 00:00:00 2001
From: Andreas Cadhalpun <Andreas.Cadhalpun@googlemail.com>
Date: Mon, 2 Feb 2015 00:20:18 +0100
Subject: [PATCH] stop embedding the build date

Theis makes the build binary reproducible.

Signed-off-by: Andreas Cadhalpun <Andreas.Cadhalpun@googlemail.com>
Signed-off-by: Michael Niedermayer <michaelni@gmx.at>
---
 cmdutils.c          |  3 +--
 doc/Makefile        |  4 ++--
 doc/doxy-wrapper.sh |  1 +
 doc/t2h.pm          | 17 +++++++++++++++++
 ffprobe.c           |  2 --
 5 files changed, 21 insertions(+), 6 deletions(-)

diff --git a/cmdutils.c b/cmdutils.c
index 53268d8..6c40df9 100644
--- a/cmdutils.c
+++ b/cmdutils.c
@@ -1081,8 +1081,7 @@ static void print_program_info(int flags, int level)
         av_log(NULL, level, " Copyright (c) %d-%d the FFmpeg developers",
                program_birth_year, CONFIG_THIS_YEAR);
     av_log(NULL, level, "\n");
-    av_log(NULL, level, "%sbuilt on %s %s with %s\n",
-           indent, __DATE__, __TIME__, CC_IDENT);
+    av_log(NULL, level, "%sbuilt with %s\n", indent, CC_IDENT);
 
     av_log(NULL, level, "%sconfiguration: " FFMPEG_CONFIGURATION "\n", indent);
 }
diff --git a/doc/Makefile b/doc/Makefile
index 2502922..745576c 100644
--- a/doc/Makefile
+++ b/doc/Makefile
@@ -114,9 +114,9 @@ doc/%-all.pod: doc/%.texi $(SRC_PATH)/doc/texi2pod.pl $(GENTEXI)
 
 doc/%.1 doc/%.3: TAG = MAN
 doc/%.1: doc/%.pod $(GENTEXI)
-	$(M)pod2man --section=1 --center=" " --release=" " $< > $@
+	$(M)pod2man --section=1 --center=" " --release=" " --date=" " $< > $@
 doc/%.3: doc/%.pod $(GENTEXI)
-	$(M)pod2man --section=3 --center=" " --release=" " $< > $@
+	$(M)pod2man --section=3 --center=" " --release=" " --date=" " $< > $@
 
 $(DOCS) doc/doxy/html: | doc/
 $(DOC_EXAMPLES:%$(EXESUF)=%.o): | doc/examples
diff --git a/doc/doxy-wrapper.sh b/doc/doxy-wrapper.sh
index d88f60e..bbdb909 100755
--- a/doc/doxy-wrapper.sh
+++ b/doc/doxy-wrapper.sh
@@ -10,4 +10,5 @@ $DOXYGEN - <<EOF
 @INCLUDE        = ${DOXYFILE}
 INPUT           = $@
 EXAMPLE_PATH    = ${SRC_PATH}/doc/examples
+HTML_TIMESTAMP  = NO
 EOF
diff --git a/doc/t2h.pm b/doc/t2h.pm
index ca77842..5efb2da 100644
--- a/doc/t2h.pm
+++ b/doc/t2h.pm
@@ -186,6 +186,23 @@ EOT
 }
 texinfo_register_formatting_function('begin_file', \&ffmpeg_begin_file);
 
+sub ffmpeg_program_string($)
+{
+  my $self = shift;
+  if (defined($self->get_conf('PROGRAM'))
+      and $self->get_conf('PROGRAM') ne ''
+      and defined($self->get_conf('PACKAGE_URL'))) {
+    return $self->convert_tree(
+      $self->gdt('This document was generated using @uref{{program_homepage}, @emph{{program}}}.',
+         { 'program_homepage' => $self->get_conf('PACKAGE_URL'),
+           'program' => $self->get_conf('PROGRAM') }));
+  } else {
+    return $self->convert_tree(
+      $self->gdt('This document was generated automatically.'));
+  }
+}
+texinfo_register_formatting_function('program_string', \&ffmpeg_program_string);
+
 # Customized file ending
 sub ffmpeg_end_file($)
 {
diff --git a/ffprobe.c b/ffprobe.c
index 38879f1..d352bb6 100644
--- a/ffprobe.c
+++ b/ffprobe.c
@@ -2562,8 +2562,6 @@ static void ffprobe_show_program_version(WriterContext *w)
     print_str("version", FFMPEG_VERSION);
     print_fmt("copyright", "Copyright (c) %d-%d the FFmpeg developers",
               program_birth_year, CONFIG_THIS_YEAR);
-    print_str("build_date", __DATE__);
-    print_str("build_time", __TIME__);
     print_str("compiler_ident", CC_IDENT);
     print_str("configuration", FFMPEG_CONFIGURATION);
     writer_print_section_footer(w);
-- 
2.1.4

